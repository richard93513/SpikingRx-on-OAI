# ğŸŸ© SpikingRx-on-OAI â€” 1126 å®Œæ•´æŠ€è¡“ç­†è¨˜
ï¼ˆåŒ…å« fullgrid dumpã€TX TB dumpã€æ•´ç†ã€bundleã€è‡ªå‹• inferenceï¼‰

file:///home/richard93513/%E4%B8%8B%E8%BC%89/Untitled%20diagram-2025-11-26-174023.png

---

# ğŸ“˜ 0. ä»Šæ—¥ç›®æ¨™èˆ‡æˆæœæ‘˜è¦

æœ¬æ¬¡æ›´æ–°ä¸»è¦å®Œæˆï¼š

- é‡æ§‹ OAI Dump æ©Ÿåˆ¶ â†’ ç§»é™¤ /tmpï¼Œçµ±ä¸€å„²å­˜åˆ° repo  
- æ–°å¢ Full-grid Dumpï¼ˆæ¥æ”¶ç«¯ RXï¼‰ â†’ æ­£å¸¸é‹ä½œ  
- æ–°å¢ TX TB Bits Dumpï¼ˆç™¼é€ç«¯ TXï¼‰ â†’ æ­£å¸¸é‹ä½œ  
- ä¿®æ­£ OAI dump æ ¼å¼ ï¼† å‘½åæ•´åˆ  
- æ–°å¢ Python Loaderï¼ˆæ–°ç‰ˆï¼‰ï¼šoai_to_spikingrx_tensor.py  
- ä¿®å¾© inference pipelineï¼ŒLLR output æ­£å¸¸  
- æ–°å¢ Bundle å·¥å…·ï¼šbundle_records.py è‡ªå‹•æ•´ç†è³‡æ–™  
- è³‡æ–™çµæ§‹æ­£å¼å®šå‹ï¼šspx_records/  
- ç‚ºå¾ŒçºŒ LDPC decoder & BER pipeline åšæº–å‚™  

---

# ğŸ“— 1. OAI Dump ç³»çµ±æ”¹å‹•ï¼ˆC ç¨‹å¼ç¢¼ï¼‰

æœ¬æ¬¡æ”¹å‹• OAI å…©å€‹éƒ¨åˆ†ï¼š

---

## 1.1 Full-grid Dumpï¼ˆUE æ¥æ”¶ç«¯ï¼‰

â— ä½ç½®  
openairinterface5g/openair1/PHY/NR_UE_TRANSPORT/nr_dlsch_demodulation.c

â— ç”¨é€”  
æŠŠ UE ç«¯åšå®Œ FFT å¾Œçš„ **14 Ã— 2048 complex16** å…¨é »åŸŸ grid dump ä¸‹ä¾†ã€‚

â— æª”åå‰ç¶´  
```
f<frame>_s<slot>_fullgrid_idx<XXXXXX>.bin
```
ä¾‹å¦‚ï¼š
```
f0278_s01_fullgrid_idx000032.bin
```

â— æª”æ¡ˆå…§å®¹æ ¼å¼

| å€å¡Š   | å‹æ…‹              | å¤§å°       | èªªæ˜ |
|--------|-------------------|------------|-------|
| Header | uint16 Ã— 8        | 16 bytes   | frame, slot, n_sym, n_sc, first_sc, cwâ€¦ |
| Payload| int16 Ã— 2 Ã— (14Ã—2048) | 57344 bytes | I/Q å€¼ complex16 |

â— ç¨‹å¼ç¢¼ä½ç½®ï¼ˆç©ºä½çµ¦ä½ è²¼ï¼‰
```c
// FULLGRID DUMP CODE HERE
```

---

## 1.2 TX TB Bits Dumpï¼ˆgNB ç™¼é€ç«¯ï¼‰

â— ä½ç½®  
openairinterface5g/openair1/PHY/NR_TRANSPORT/nr_dlsch_coding.c

â— ç”¨é€”  
Dump **æœª CRCã€æœª LDPC çš„åŸå§‹ bits**ï¼ˆA bits â†’ A/8 bytesï¼‰

â— æª”åå‰ç¶´  
```
f<frame>_s<slot>_txbits_idx<XXXXXX>_rnti<XXXXX>.bin
```
ä¾‹å¦‚ï¼š
```
f0458_s00_txbits_idx001243_rnti65535.bin
```

â— æª”æ¡ˆæ ¼å¼

| å€æ®µ   | å…§å®¹                    | å‹æ…‹  |
|--------|--------------------------|--------|
| Payload| A/8 bytesï¼ˆç³»çµ±è¼¸å…¥ bitsï¼‰ | uint8 |

â— ç¨‹å¼ç¢¼ç©ºä½
```c
// TX TB DUMP CODE HERE
```

---

# ğŸ“˜ 2. Dump è³‡æ–™æœ€çµ‚å­˜æ”¾çµæ§‹

å·²çµ±ä¸€ç›®éŒ„çµæ§‹ï¼š

```
SpikingRx-on-OAI/
  spx_records/
    raw/
      f0278_s01_fullgrid_idx000032.bin
      f0278_s00_txbits_idx001243_rnti65535.bin
      ...
    bundle/
      f0278_s01/
        fullgrid.bin
        txbits.bin
        meta.json
```

raw â†’ bundle â†’ inference  
**åˆ†é–‹ã€ä¹¾æ·¨ã€å¯è¿½è¹¤**

---

# ğŸ“— 3. Python Loaderï¼ˆæ–°ç‰ˆï¼‰

`oai_to_spikingrx_tensor.py`

â— åŠŸèƒ½ï¼š

- è®€ fullgrid bin  
- parse headerï¼ˆframe/slot/n_sym/n_scâ€¦ï¼‰  
- reshape â†’ (14,2048)  
- æ“·å–ä¸­å¿ƒ 106 PRB â†’ 1272 SC  
- å£“ç¸®æˆ 32Ã—32  
- æ™‚åŸŸè£œé›¶è‡³ 32 rows  
- è¼¸å‡º Tensorï¼š(1,5,2,32,32)

â— è¼¸å‡ºæ ¼å¼

| åç¨± | å‹æ…‹ | èªªæ˜ |
|------|-------|-------|
| x    | torch.float32 | (1,5,2,32,32) |
| meta | dict | frameã€slotã€used_scã€first_scâ€¦ |

â— ç¨‹å¼ç¢¼ç©ºä½ï¼š
```python
# NEW LOADER CODE HERE
```

---

# ğŸ“˜ 4. Inference Pipeline

`run_spikingrx_on_oai_dump.py`

ä½ å·²æˆåŠŸï¼š

âœ” fullgrid â†’ Tensor  
âœ” è¼‰å…¥ checkpoint  
âœ” forward â†’ LLR  
âœ” å„²å­˜ï¼š

- llr.npy
- llr_heatmap.png
- spike_rate.png
- llr_int8_for_oai.bin

â— LLR int8 æ ¼å¼ï¼ˆå¾ŒçºŒçµ¦ OAI LDPC decoderï¼‰

| åç¨± | é•·åº¦ | èªªæ˜ |
|------|--------|--------|
| llr_int8 | G bits | flatten å¾Œè½‰ int8 [-127,127] |

â— è¼¸å‡ºç›®éŒ„
```
src/inference/out/
  llr.npy
  llr_heatmap.png
  spike_rate.png
  llr_int8_for_oai.bin
```

â— ç¨‹å¼ç¢¼ç©ºä½ï¼š
```python
# RUN SPIKINGRX ON FULLGRID CODE HERE
```

---

# ğŸ“— 5. bundle_records.py â€” è‡ªå‹•é…å°å·¥å…·

ä½ å·²æˆåŠŸè·‘å‡ºï¼š

```
Found 88 fullgrid files
Found 1884 txbits files
[OK] Bundled frame=1002 slot=1 â†’ f1002_s01
...
```

â— é…å°è¦å‰‡ï¼š

- fullgridï¼ˆRXï¼‰ç‚ºä¸»  
- æ‰¾åŒ frame çš„ txbits  
- ä¾ idx èˆ‡ fg_idx æœ€æ¥è¿‘é…å°  
- å»ºç«‹ bundle:

```
spx_records/bundle/fXXXX_sYY/
  fullgrid.bin
  txbits.bin
  meta.json
```

â— meta.json ç¯„ä¾‹
```json
{
  "frame": 458,
  "slot": 1,
  "fg_idx": 3,
  "tx_idx": 1243,
  "rnti": 65535,
  "fullgrid_file": "f0458_s01_fullgrid_idx000003.bin",
  "txbits_file": "f0458_s00_txbits_idx001243_rnti65535.bin"
}
```

â— ç¨‹å¼ç¢¼ç©ºä½
```python
# BUNDLE TOOL CODE HERE
```

---

# ğŸ“˜ 6. å·²å®Œæˆçš„è³‡æ–™æµç¨‹ï¼ˆç¸½çµï¼‰

```
[OAI gNB TX] â†’ dump txbits.bin
[OAI UE RX] â†’ dump fullgrid.bin
        â†“
bundle_records.py
        â†“
(fullgrid.bin, txbits.bin, meta.json)
        â†“
run_spikingrx_on_oai_dump.py
        â†“
SpikingRx LLR
        â†“
llr_int8_for_oai.bin
```

ä¸‹ä¸€æ­¥ï¼š

```
llr_int8_for_oai.bin + txbits.bin
 â†’ OAI LDPC decoder
 â†’ decoded bits
 â†’ BER
```

---

# ğŸ“™ 7. å„ç¨®è³‡æ–™çš„æ ¼å¼ç¸½æ•´ç†ï¼ˆè¶…é‡è¦ï¼‰

## 7.1 TX TB Bitsï¼ˆtxbits.binï¼‰

| éƒ¨åˆ† | èªªæ˜ |
|-------|--------|
| é•·åº¦ | A / 8 bytes |
| å‹æ…‹ | uint8 |
| ä¾†æº | nr_dlsch_coding |
| ç”¨é€” | BER ground truth |

---

## 7.2 Full-grid Dumpï¼ˆfullgrid.binï¼‰

### Header (uint16 Ã— 8)

| index | key | èªªæ˜ |
|--------|------|--------|
| 0 | frame |
| 1 | slot |
| 2 | start_symbol (0) |
| 3 | n_sym (14) |
| 4 | n_sc_full (2048) |
| 5 | rx_ant (0) |
| 6 | cw (0) |
| 7 | reserved |

### Payload
- shape = (14 Ã— 2048)
- æ¯å€‹å…ƒç´  complex16 = (int16 real, int16 imag)

---

## 7.3 Loader è¼¸å‡º Tensor

```
(1, T=5, 2, 32, 32)
```

---

## 7.4 SpikingRx LLR è¼¸å‡º

| åç¨± | æ ¼å¼ |
|--------|----------|
| llr.npy | float32 (1,32,32,2) |
| llr_int8_for_oai.bin | flatten int8 |

---

# ğŸ“˜ 8. æœ¬æ—¥æˆæœç¸½çµï¼ˆ1126ï¼‰

ä½ ä»Šå¤©å®Œæˆï¼š

âœ” UE fullgrid dump  
âœ” TX TB bits dump  
âœ” çµ±ä¸€è³‡æ–™å„²å­˜çµæ§‹  
âœ” loader æ–°ç‰ˆ  
âœ” inference pipeline  
âœ” LLR è¼¸å‡ºå®Œæ•´  
âœ” bundleï¼ˆæˆåŠŸ 88 çµ„ fullgridï¼‰  
âœ” å·²æº–å‚™æ‰€æœ‰ BER pipeline éœ€è¦çš„è³‡æ–™  

ç¾åœ¨ä½ çš„ç³»çµ±æ˜¯å®Œæ•´çš„ï¼š

```
OAI â†’ SpikingRx â†’ LLR â†’ (æº–å‚™åš BER)
```

---

# ğŸ“• 9. ä¸‹ä¸€æ­¥ï¼ˆæ˜å¤©æˆ–ä¸‹ä¸€éšæ®µï¼‰

## â­ Fï¼šå»ºç«‹ OAI LDPC decoder Python binding
- æå– nrLDPC decoder  
- ç·¨æˆ libldpc.so  
- Python ctypes åŒ…è£  
- llr + txbits â†’ decoded bits â†’ BER  

## â­ Gï¼šå»ºç«‹ run_ber.py
- è®€å–æ‰€æœ‰ bundle  
- æ¯çµ„ dump åšï¼šLLR â†’ decode â†’ æ¯”å° bits  
- ç”¢ç”Ÿ BER CSV  
- BER curves  
- heatmaps  

---

