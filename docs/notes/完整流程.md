# ğŸ“„ OAI â†’ Full-grid Dump â†’ SpikingRx å…¨æµç¨‹ï¼ˆA4 æœ€ç°¡ç‰ˆï¼‰

ä»¥ä¸‹æ‰€æœ‰æŒ‡ä»¤éƒ½ä¾ç…§ä½ ç¾åœ¨çš„å¯¦éš›è·¯å¾‘ã€å¯¦éš› pipelineã€å¯¦éš›ç¿’æ…£æ’°å¯«ï¼Œå¯ç›´æ¥è²¼åˆ° README / md ç­†è¨˜ä¸­ä½¿ç”¨ã€‚

---

## (A) ç·¨è­¯ OAIï¼ˆgNB + UEï¼‰

1. æ¸…é™¤èˆŠ buildï¼ˆé¿å…ç‰ˆæœ¬è¡çªï¼‰
```
cd ~/openairinterface5g/cmake_targets/ran_build/build
rm -rf CMakeCache.txt CMakeFiles
```

2. é‡æ–°ç·¨è­¯ï¼ˆSIMU / RFsim æ¨¡å¼ï¼‰
```
cd ~/openairinterface5g/cmake_targets
./build_oai --gNB --nrUE -w SIMU
```

---

## âœ… (B) å•Ÿå‹• gNBï¼ˆRFsim æ¨¡å¼ï¼Œæœ€æ–°ç‰ˆã€ä½ ç¾åœ¨ç”¨çš„ï¼‰

åœ¨ Terminal 1ï¼š
```
cd ~/openairinterface5g/cmake_targets/ran_build/build

sudo ./nr-softmodem \
  --rfsim \
  --phy-test \
  -O ../../../targets/PROJECTS/GENERIC-NR-5GC/CONF/gnb.sa.band78.fr1.106PRB.usrpb210.conf \
  --gNBs.[0].min_rxtxtime 6
```

ğŸŸ¢ æ³¨æ„ï¼šå¯«æ³•å¿…é ˆæ˜¯ `--gNBs.[0].min_rxtxtime 6`ï¼ˆä¸­é–“**æ²’æœ‰ç­‰è™Ÿ**ï¼‰ã€‚

---

## âœ… (C) å•Ÿå‹• UEï¼ˆRFsim æ¨¡å¼ï¼‰

åœ¨ Terminal 2ï¼š
```
sudo ./nr-uesoftmodem \
  --rfsim \
  --phy-test \
  -r 106 \
  --numerology 1 \
  --band 78 \
  -C 3619200000 \
  -O ../../../targets/PROJECTS/GENERIC-NR-5GC/CONF/ue.conf
```

---

## âœ… (D) Raw Dumpï¼ˆFullgrid / TXBITS / LDPC / OAI LLRï¼‰

OAI patch æœƒè¼¸å‡ºå››ç¨® raw æª”æ¡ˆåˆ°ï¼š

```
~/SpikingRx-on-OAI/spx_records/raw/
```

ç¯„ä¾‹ï¼š
```
fXXXX_sYY_fullgrid_idxNNNNNN.bin
fXXXX_sYY_txbits_idxNNNNNN_rntiXXXX.bin
fXXXX_sYY_ldpc_cfg_idxNNNNNN.txt
fXXXX_sYY_oai_llr_idxNNNNNN.bin
```

ç¢ºèªæ˜¯å¦æ­£å¸¸ dumpï¼š
```
ls -ltr ~/SpikingRx-on-OAI/spx_records/raw | tail
```

---

## âœ… (E) Raw â†’ Bundleï¼ˆè‡ªå‹•é…å° fullgrid / txbits / ldpc / OAI LLRï¼‰

åŸ·è¡Œï¼š
```
cd ~/SpikingRx-on-OAI
source .venv/bin/activate
python src/tools/bundle_records.py
```


è¼¸å‡ºç¯„ä¾‹ï¼š
```
spx_records/bundle/f0424_s05/
â”œâ”€â”€ fullgrid.bin
â”œâ”€â”€ txbits.bin
â”œâ”€â”€ ldpc_cfg.txt
â”œâ”€â”€ oai_llr.bin
â””â”€â”€ meta.json
```

æ¯å€‹ bundle ä»£è¡¨ä¸€ç­†å®Œæ•´ PDSCH å‚³è¼¸ã€‚

---

## âœ… (F) æ–°ç‰ˆ SpikingRx è¨“ç·´ï¼ˆç”¨ OAI LLR ç•¶ labelï¼‰

åŸ·è¡Œï¼š
```
cd ~/SpikingRx-on-OAI
source .venv/bin/activate
python src/train/train_spikingrx_oai.py
```

è¨“ç·´è³‡æ–™ï¼š
- `x` = fullgrid.bin â†’ (T=3, H=32, W=32)
- `y` = oai_llr.binï¼ˆé•·åº¦ G = 14400ï¼‰

æ¨¡å‹ç›®æ¨™ï¼š  
æ¨¡ä»¿ OAI çš„ demapperï¼Œä½¿ SpikingRx è¼¸å‡ºèˆ‡ OAI LLR è¶Šæ¥è¿‘è¶Šå¥½ã€‚

æœ€ä½³æ¬Šé‡æœƒå­˜åˆ°ï¼š
```
src/train/best_spikingrx_model.pth
```

---

## âœ… (G) æ–°ç‰ˆ Inference + LDPC è§£ç¢¼ + BERï¼ˆæ•´åˆç‰ˆï¼‰

åŸ·è¡Œï¼š
```
cd ~/SpikingRx-on-OAI
source .venv/bin/activate
python src/inference/batch_inference_on_bundle.py
```
å°æ¯å€‹ bundle è‡ªå‹•å®Œæˆï¼š

1. **fullgrid â†’ SpikingRx inference**
2. ç”¢ç”Ÿï¼š
   - `infer_llr_float.npy`
   - `infer_llr_int8.bin`
3. **å‘¼å« OAI LDPC Decoderï¼š**
```
ldpctest_spx infer_llr_int8.bin ldpc_cfg.txt decoded_bits.bin
```
4. è§£å‡º `decoded_bits.bin`
5. æ¯”å° `txbits.bin` â†’ è¨ˆç®— BER
6. åœ¨ terminal é¡¯ç¤ºæ¯ç­† BER & æœ€çµ‚ç¸½è¡¨

è¼¸å‡ºæª”æ¡ˆï¼ˆbundle è³‡æ–™å¤¾ï¼‰ï¼š
```
fullgrid.bin
txbits.bin
ldpc_cfg.txt
oai_llr.bin
meta.json

infer_llr_float.npy
infer_llr_int8.bin
decoded_bits.bin
infer_meta.json
```

---

## ğŸš€ (H) è¨“ç·´æ–°æ¬Šé‡å¾Œï¼Œå†è·‘ä¸€æ¬¡ inference + BER

åªè¦é‡æ–°è¨“ç·´ï¼š
```
cd ~/SpikingRx-on-OAI
source .venv/bin/activate
python src/train/train_spikingrx_oai.py
```

æœƒæ›´æ–°ï¼š
best_spikingrx_model.pth

è¤‡è£½ç¨‹å¼ç¢¼

æ¥è‘—å†æ¬¡è·‘ï¼š
```
python src/inference/batch_inference_on_bundle.py
```

å³å¯ç”¨æ–°æ¨¡å‹è‡ªå‹•é‡æ–°ï¼š

- ç”¢ç”Ÿæ–° LLR
- LDPC è§£ç¢¼
- è¨ˆç®— BER
- æ›´æ–°çµæœ

---

**å®Œæ•´æµç¨‹ç¸½çµï¼š**

**OAI gNB/UEï¼ˆRFsimï¼‰  
â†’ Raw Dumpï¼ˆfullgrid / txbits / ldpc_cfg / oai_llrï¼‰  
â†’ bundle_records.py  
â†’ train_spikingrx_oai.pyï¼ˆä»¥ OAI LLR ç•¶ label è¨“ç·´ï¼‰  
â†’ batch_inference_on_bundle.py  
â†’ SpikingRx LLR â†’ LDPC è§£ç¢¼ â†’ BER çµæœ**
