# ğŸ“„ OAI â†’ Full-grid Dump â†’ SpikingRx å…¨æµç¨‹ï¼ˆA4 æœ€ç°¡ç‰ˆï¼‰

ä»¥ä¸‹æ‰€æœ‰æŒ‡ä»¤éƒ½ä¾ç…§ä½ ç¾åœ¨çš„å¯¦éš›è·¯å¾‘ã€å¯¦éš› pipelineã€å¯¦éš›ç¿’æ…£æ’°å¯«ï¼Œå¯ç›´æ¥è²¼åˆ° README / md ç­†è¨˜ä¸­ä½¿ç”¨ã€‚

---

## (A) ç·¨è­¯ OAIï¼ˆgNB + UEï¼‰

1. æ¸…é™¤èˆŠ buildï¼ˆé¿å…ç‰ˆæœ¬è¡çªï¼‰

    cd ~/openairinterface5g/cmake_targets/ran_build/build
    rm -rf CMakeCache.txt CMakeFiles

2. é‡æ–°ç·¨è­¯ï¼ˆSIMU / RFsim æ¨¡å¼ï¼‰

    cd ~/openairinterface5g/cmake_targets
    ./build_oai --gNB --nrUE -w SIMU

---

## âœ… (B) å•Ÿå‹• gNBï¼ˆRFsim æ¨¡å¼ï¼Œæœ€æ–°ç‰ˆã€ä½ ç¾åœ¨ç”¨çš„ï¼‰

åœ¨ Terminal 1ï¼š

    cd ~/openairinterface5g/cmake_targets/ran_build/build

    ./nr-softmodem \
      --rfsim \
      -O ../../../targets/PROJECTS/GENERIC-NR-5GC/CONF/gnb.sa.band78.fr1.106PRB.usrpb210.conf \
      --gNBs.[0].min_rxtxtime=6

ğŸŸ¢ æ³¨æ„ï¼š`--gNBs.[0].min_rxtxtime 6` å¿…é ˆå¯«æˆ **ç­‰è™Ÿå½¢å¼**ï¼ˆ`=6`ï¼‰ï¼Œå¦å‰‡æœƒè¢«ç•¶æˆ unknown optionã€‚

---

## âœ… (C) å•Ÿå‹• UEï¼ˆRFsim æ¨¡å¼ï¼Œæœ€æ–°ç‰ˆã€ä½ ç¾åœ¨ç”¨çš„ï¼‰

åœ¨ Terminal 2ï¼š

    cd ~/openairinterface5g/cmake_targets/ran_build/build

    ./nr-uesoftmodem \
      --rfsim \
      -r 106 --numerology 1 --band 78 -C 3619200000 \
      -O ../../../targets/PROJECTS/GENERIC-NR-5GC/CONF/ue.conf

è‹¥ä½ è¦æ”¹ç”¨ SLIC ç‰ˆï¼Œå¯å†å¦å¤–ä¿®æ”¹è¨­å®šæª”ï¼›
ä½†ç›®å‰ `ue.conf` å·²å¯ç”¨ï¼Œ**ä¸éœ€è¦æ›´å‹•**ã€‚

---

## âœ… (D) ç¢ºèª Raw Dump æ˜¯å¦æ­£å¸¸ï¼ˆFullgrid / TXBITS / LDPCï¼‰

ä½ çš„ patch æœƒè¼¸å‡º 3 ç¨® raw æª”æ¡ˆåˆ°ï¼š

    ~/SpikingRx-on-OAI/spx_records/raw/

çµæ§‹å¦‚ä¸‹ï¼š

    spx_records/raw/
        fXXXX_sYY_fullgrid_idxNNNNNN.bin
        fXXXX_sYY_ldpc.json
        fXXXX_sYY_txbits_idxNNNNNN_rntiXXXX.bin

å¿«é€Ÿæª¢æŸ¥æœ€æ–°æª”æ¡ˆï¼š

    ls -ltr ~/SpikingRx-on-OAI/spx_records/raw | tail

æª¢æŸ¥é‡é»ï¼š

- `idx` æ˜¯å¦æŒçºŒå¢åŠ ï¼ˆç¢ºèª dump æœ‰åœ¨è·‘ï¼‰
- `frame-slot` æ˜¯å¦æœ‰è®Šå‹•
- `fullgrid / ldpc / txbits` ä¸‰ç¨®æª”æ¡ˆæ˜¯å¦éƒ½æœ‰å°æ‡‰å‡ºç¾

å¿…è¦æ™‚å¯æŠ½ä¸€ç­† raw çœ‹ headerï¼š

    xxd -g2 -l 32 ~/SpikingRx-on-OAI/spx_records/raw/f0424_s05_fullgrid_idx000004.bin

---

## âœ… (E) Raw â†’ Bundleï¼ˆæˆå° fullgrid + txbitsï¼‰

ä½ å¯«çš„ `bundle_records.py` å·²ç¶“å®Œæˆä»¥ä¸‹å·¥ä½œï¼š

- æ ¹æ“š `frame + slot` è‡ªå‹•é…å°åŒä¸€ç­† PDSCH
- å¹«ä½ æ‰¾å‡ºå°æ‡‰çš„ï¼š
  - `fullgrid`
  - `txbits`
  - `ldpc_cfg`
  - `meta.json`
- ä»¥ `frame + slot` å»ºç«‹ä¸€å€‹ bundle è³‡æ–™å¤¾ï¼Œä¾‹å¦‚ï¼š`f0424_s05/`

ä½¿ç”¨æ–¹å¼ï¼š

    ã„
    python src/tools/bundle_records.py

è¼¸å‡ºçµæ§‹ç¯„ä¾‹ï¼š

    spx_records/bundle/f0424_s05/
        â”œâ”€â”€ fullgrid.bin
        â”œâ”€â”€ txbits.bin
        â”œâ”€â”€ ldpc_cfg.json
        â””â”€â”€ meta.json

ğŸŸ¢ é€™ä¸€æ­¥éå¸¸é‡è¦ï¼Œå¯ä»¥é¿å…ã€Œfullgrid è·Ÿ txbits å°ä¸åˆ°ã€çš„å•é¡Œï¼Œæ˜¯ä¹‹å¾Œåš BER çš„åŸºç¤ã€‚

---

## âœ… (F) æ–°ç‰ˆ SpikingRx Inferenceï¼ˆä¸€æ¬¡è·‘æ•´å€‹ bundleï¼‰

ä½ ç¾åœ¨æ–°çš„ inference script æ˜¯ï¼š
    
    src/inference/run_spikingrx_on_bundle.py

åŠŸèƒ½ï¼š

- è‡ªå‹•æƒæ `spx_records/bundle/*/`
- å°æ¯ä¸€å€‹ `fXXXX_sYY/`ï¼š
  - è®€å– `fullgrid.bin`
  - ä¸Ÿé€² SpikingRx åš inference
  - è¼¸å‡º LLRï¼ˆfloat / int8ï¼‰èˆ‡å¯è¦–åŒ–åœ–

ä½¿ç”¨æ–¹å¼ï¼š

    cd ~/SpikingRx-on-OAI
    source .venv/bin/activate

    python src/inference/run_spikingrx_on_bundle.py

å°å–®ä¸€ bundle çš„è¼¸å‡ºï¼ˆç¯„ä¾‹ï¼‰ï¼š

    spx_records/bundle/f0424_s05/
        â”œâ”€â”€ infer_llr_float.npy
        â”œâ”€â”€ infer_llr_int8.bin   â† å¯ç›´æ¥ä¸Ÿçµ¦ OAI LDPC è§£ç¢¼å™¨
        â”œâ”€â”€ llr_heatmap.png
        â”œâ”€â”€ spike_rate.png
        â””â”€â”€ infer_meta.json

---

## âœ… (G) Trainingï¼ˆå’Œä»¥å‰ä¸€æ¨£ï¼‰

    cd ~/SpikingRx-on-OAI
    python src/train/train_spikingrx.py

è¨“ç·´å¾Œ checkpoint æœƒå­˜æ”¾åœ¨ï¼š

    src/train/spikingrx_checkpoint.pth

---

## ğŸš€ (H) è¨“ç·´å¾Œå†æ¬¡è·‘æ–°ç‰ˆå¤šç­† inference

è¨“ç·´å®Œï¼ˆæˆ–æ›æ–° checkpointï¼‰å¾Œï¼Œåªè¦å†è·‘ä¸€æ¬¡ï¼š

    python src/inference/run_spikingrx_on_bundle.py

Script æœƒè‡ªå‹•è¼‰å…¥ï¼š

    src/train/spikingrx_checkpoint.pth

ä¸¦å°æ‰€æœ‰ `bundle/` è£¡çš„ fullgrid é‡æ–°åšä¸€æ¬¡ SpikingRx æ¨è«–ï¼Œ
æ›´æ–°å°æ‡‰çš„ï¼š

- `infer_llr_float.npy`
- `infer_llr_int8.bin`
- `llr_heatmap.png`
- `spike_rate.png`
- `infer_meta.json`

æ•´æ¢æµç¨‹å°±æ˜¯ï¼š

**OAI gNB/UEï¼ˆRFsimï¼‰ â†’ Raw Dumpï¼ˆfullgrid / txbits / ldpcï¼‰ â†’ bundle_records.py â†’ SpikingRx on bundle â†’ LLR int8 â†’ OAI LDPC decoderï¼ˆä¸‹ä¸€æ­¥åš BER æ¯”è¼ƒï¼‰**

---
